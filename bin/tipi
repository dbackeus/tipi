#!/usr/bin/env ruby

require File.expand_path('../lib/polyphony/http/server', __dir__)
require File.expand_path('../lib/polyphony/http/server/rack_adapter', __dir__)

app_path = ARGV.first || './config.ru'
app = Polyphony::HTTP::Server::RackAdapter.load(app_path)
opts = { reuse_addr: true, dont_linger: true }

puts "listening on port 1234"
puts "pid: #{Process.pid}"
Polyphony::HTTP::Server.serve('0.0.0.0', 1234, opts, &app)
